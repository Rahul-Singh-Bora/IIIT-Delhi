<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SortIQ - Email Analysis</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
        </svg>
        SortIQ
      </h1>
      <button id="settingsBtn" class="icon-btn" title="Settings">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path d="M10 6a4 4 0 1 0 0 8 4 4 0 0 0 0-8zM8 10a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"/>
          <path d="M10 0a1 1 0 0 1 1 1v1.07a7.5 7.5 0 0 1 1.5.43l.76-.76a1 1 0 1 1 1.42 1.42l-.76.76c.26.46.46.96.59 1.5H16a1 1 0 1 1 0 2h-1.49a7.5 7.5 0 0 1-.59 1.5l.76.76a1 1 0 0 1-1.42 1.42l-.76-.76a7.5 7.5 0 0 1-1.5.59V17a1 1 0 1 1-2 0v-1.07a7.5 7.5 0 0 1-1.5-.43l-.76.76a1 1 0 0 1-1.42-1.42l.76-.76a7.5 7.5 0 0 1-.59-1.5H4a1 1 0 1 1 0-2h1.49a7.5 7.5 0 0 1 .59-1.5l-.76-.76a1 1 0 0 1 1.42-1.42l.76.76a7.5 7.5 0 0 1 1.5-.59V1a1 1 0 0 1 1-1z"/>
        </svg>
      </button>
    </header>

    <div id="loadingState" class="state-view">
      <div class="loader"></div>
      <p>Analyzing email with AI...</p>
    </div>

    <div id="noEmailState" class="state-view" style="display: none;">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <rect x="3" y="5" width="18" height="14" rx="2" stroke-width="2"/>
        <path d="M3 7l9 6 9-6" stroke-width="2"/>
      </svg>
      <h2>No Email Selected</h2>
      <p>Open an email in Gmail and click "Analyze with AI" to get started.</p>
    </div>

    <div id="analysisView" style="display: none;">
      <!-- Email Info -->
      <div class="email-info">
        <div class="email-header">
          <span class="sender-name" id="senderName"></span>
          <span class="email-date" id="emailDate"></span>
        </div>
        <div class="email-subject" id="emailSubject"></div>
      </div>

      <!-- Analysis Results -->
      <div class="analysis-section">
        <h3>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
          </svg>
          Priority Analysis
        </h3>
        <div class="badge-container">
          <span class="badge" id="priorityBadge"></span>
          <span class="badge" id="importanceBadge"></span>
        </div>
        <p class="reason" id="priorityReason"></p>
      </div>

      <div class="analysis-section">
        <h3>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/>
          </svg>
          Summary
        </h3>
        <p id="emailSummary"></p>
      </div>

      <div class="analysis-section" id="actionItemsSection" style="display: none;">
        <h3>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
          </svg>
          Action Items
        </h3>
        <ul id="actionItemsList"></ul>
      </div>

      <div class="analysis-section" id="categoriesSection" style="display: none;">
        <h3>Categories</h3>
        <div class="tag-container" id="categoriesList"></div>
      </div>

      <!-- Reply Generation -->
      <div class="reply-section">
        <h3>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"/>
          </svg>
          Generate Reply
        </h3>
        <div class="button-group">
          <button class="reply-btn" data-type="professional">Professional</button>
          <button class="reply-btn" data-type="friendly">Friendly</button>
          <button class="reply-btn" data-type="brief">Brief</button>
          <button class="reply-btn" data-type="detailed">Detailed</button>
          <button class="reply-btn" data-type="decline">Decline</button>
        </div>
        
        <div id="replyOutput" class="reply-output" style="display: none;">
          <div class="reply-header">
            <span>Generated Reply</span>
            <button id="copyReplyBtn" class="icon-btn" title="Copy to clipboard">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
              </svg>
            </button>
          </div>
          <textarea id="replyText" rows="8"></textarea>
        </div>
      </div>
    </div>

    <div id="errorState" class="state-view error-view" style="display: none;">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <circle cx="12" cy="12" r="10" stroke-width="2"/>
        <line x1="12" y1="8" x2="12" y2="12" stroke-width="2"/>
        <line x1="12" y1="16" x2="12.01" y2="16" stroke-width="2"/>
      </svg>
      <h2>Error</h2>
      <p id="errorMessage"></p>
      <button id="retryBtn" class="primary-btn">Retry</button>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
